<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P.O.MFS ê³µì—° ì •ë³´ ê´€ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Outfit:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        @keyframes blink {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .test-banner {
            background-color: #dc3545;
            /* Red */
            color: white;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 1.2em;
            animation: blink 2s infinite;
            margin-bottom: 20px;
            border-radius: 8px;
        }
    </style>

<body>
    {% if env == 'TEST' %}
    <div class="test-banner">
        âš ï¸ TEST MODE (í…ŒìŠ¤íŠ¸ ëª¨ë“œ) âš ï¸
        <button onclick="resetTestDB()"
            style="margin-left: 20px; font-size: 0.8em; padding: 5px 10px; background: white; color: #dc3545; border: none; border-radius: 4px; cursor: pointer;">
            ğŸ”„ ë°ì´í„° ì´ˆê¸°í™” (Reset)
        </button>
    </div>
    {% endif %}

    <header>
        <h1>P.O.MFS ê³µì—° ì •ë³´ ê´€ë¦¬</h1>
        <nav>
            <a href="/" class="btn"
                style="background-color: transparent; border: 1px solid var(--accent-color); color: var(--accent-color);">ëŒ€ì‹œë³´ë“œ</a>
            <a href="/discovery" class="btn">ê³µì—°ì¥ ì¸ìŠ¤íƒ€ ì°¾ê¸°</a>
            <a href="/upload" class="btn">ê³µì—° ì •ë³´ ì—…ë¡œë“œ</a>
            <a href="/test_tool" class="btn" style="background-color: #dc3545; border-color: #dc3545; color: white;">ğŸ§ª í…ŒìŠ¤íŠ¸ ë„êµ¬</a>
        </nav>
    </header>

    <div class="stats-box">
        <div class="stat-card">
            <div class="stat-number">{{ stats.venues }}</div>
            <div class="stat-label">ë“±ë¡ëœ ê³µì—°ì¥</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.artists }}</div>
            <div class="stat-label">ë“±ë¡ëœ ì•„í‹°ìŠ¤íŠ¸</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.events }}</div>
            <div class="stat-label">ì§„í–‰ì¤‘ì¸ ê³µì—°</div>
        </div>
    </div>

    <div class="menu-grid">
        <!-- 1. Scrape -->
        <div class="menu-item">
            <h3 style="word-break: keep-all;">ğŸš€ ìƒˆ ê³µì—° ìˆ˜ì§‘</h3>
            <p>ì¸ìŠ¤íƒ€ê·¸ë¨ IDë¥¼ ì…ë ¥í•˜ì—¬ ìµœì‹  ê²Œì‹œë¬¼ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>
            <a href="/scrape" class="btn">ìˆ˜ì§‘ ì‹œì‘</a>
        </div>

        <!-- 2. View Events -->
        <div class="menu-item">
            <h3 style="word-break: keep-all;">ğŸ“‹ ë“±ë¡ ì •ë³´ í™•ì¸</h3>
            <p>DBì— ì €ì¥ëœ ëª¨ë“  ê³µì—° ì •ë³´ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <a href="/registered" class="btn">ì „ì²´ ëª©ë¡ ë³´ê¸°</a>
        </div>

        <!-- 3. Upload -->
        <div class="menu-item">
            <h3 style="word-break: keep-all;">ğŸ“‚ ë°ì´í„° ì—…ë¡œë“œ</h3>
            <p>CSV/JSON íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ DBì— ë“±ë¡í•©ë‹ˆë‹¤.</p>
            <a href="/upload" class="btn">ì—…ë¡œë“œ ë°”ë¡œê°€ê¸°</a>
        </div>

        <!-- 5. Marketing Tool -->
        <div class="menu-item">
            <h3 style="word-break: keep-all; color: #00ffff;">ğŸ¨ ë§ˆì¼€íŒ… ìƒì„±ê¸°</h3>
            <p>ì¸ìŠ¤íƒ€ê·¸ë¨ìš© ì¹´ë“œë‰´ìŠ¤ì™€ ìº¡ì…˜ì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.</p>
            <a href="/marketing" class="btn"
                style="background: linear-gradient(45deg, #39ff14, #00ffff); color: #000; border: none;">ìƒì„±í•˜ê¸°</a>
        </div>

        <!-- 6. Cloud Migration -->
        <div class="menu-item">
            <h3 style="word-break: keep-all; color: #ffc107;">â˜ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜</h3>
            <p>ë¡œì»¬ DB ë°ì´í„°ë¥¼ ìš´ì˜ ì„œë²„(Neon)ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.</p>
            <a href="/migration" class="btn btn-warning">ì „ì†¡í•˜ê¸°</a>
        </div>

        <!-- 4. Reset -->
        <div class="menu-item" style="border-color: var(--danger-color);">
            <h3 style="color: var(--danger-color); word-break: keep-all;">âš ï¸ ë°ì´í„° ì´ˆê¸°í™”</h3>
            <p>ëª¨ë“  ë°ì´í„°(ê³µì—°, ì´ë¯¸ì§€)ë¥¼ ì˜êµ¬ ì‚­ì œí•©ë‹ˆë‹¤.</p>
            <form action="/delete_all" method="post" onsubmit="return confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                <button type="submit" class="btn btn-danger">ì „ì²´ ì‚­ì œ</button>
            </form>
        </div>
    </div>

    <!-- Recent Events Section -->
    <div class="card recent-section">
        <h3
            style="margin-bottom: 20px; border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; display: inline-block;">
            ğŸ“… ìµœê·¼ ë“±ë¡ëœ ê³µì—° (Latest 5)
        </h3>

        {% if recent_events %}
        <table>
            <thead>
                <tr>
                    <th style="width: 35%;">ê³µì—°ëª…</th>
                    <th style="width: 20%;">ë‚ ì§œ</th>
                    <th style="width: 25%;">ì¥ì†Œ</th>
                    <th style="width: 20%;">ì•„í‹°ìŠ¤íŠ¸</th>
                </tr>
            </thead>
            <tbody>
                {% for event in recent_events %}
                <tr>
                    <td>{{ event.eventName }}</td>
                    <td>{{ event.eventDate }}</td>
                    <td>{{ event.venueName }}</td>
                    <td>
                        {% if event.artistName %}
                        {{ event.artistName }}
                        {% else %}
                        <span style="color: var(--text-muted);">(ë¯¸ì§€ì •)</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: var(--text-muted); text-align: center; padding: 20px;">ì•„ì§ ë“±ë¡ëœ ê³µì—° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% if env == 'TEST' %}
    <script>
        async function resetTestDB() {
            if (!confirm("âš ï¸ ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!")) return;

            try {
                const res = await fetch('/admin/reset_db', { method: 'POST' });
                const data = await res.json();
                if (data.success) {
                    alert("âœ… ì´ˆê¸°í™” ì™„ë£Œ!");
                    location.reload();
                } else {
                    alert("âŒ ì‹¤íŒ¨: " + data.message);
                }
            } catch (e) {
                alert("âŒ í†µì‹  ì˜¤ë¥˜: " + e);
            }
        }
    </script>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% include 'components/developer_log.html' %}
</body>

</html>